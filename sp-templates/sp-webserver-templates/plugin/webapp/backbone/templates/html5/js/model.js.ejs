<%
var validationcount = 0,
	fieldscount = serviceconfig.modelfields.length;

for( var fieldIndex in serviceconfig.modelfields) {
  	var modelfield = serviceconfig.modelfields[fieldIndex];
  	if(serviceconfig.validation && serviceconfig.validation[modelfield.field]) {
		validationcount++;
	}
}
%>

/*
 * Automatically generated by SP Control panel
 * Backbone model configuration specific to the Service - <%= serviceconfig.name %>.
 */
/**
 * Backbone model <%= serviceconfig.modelname %> 
 */
if(!window.<%= serviceconfig.modelname %> || !(window.<%= serviceconfig.modelname %> instanceof Backbone.Model))
	window.<%= serviceconfig.modelname %> = Backbone.Model.extend({});
	
window.<%= serviceconfig.modelname %> = window.<%= serviceconfig.modelname %>.extend({
	modelId:function(attrs){
		var id = this.id;
		if(!id)
			id = this.get('<%= serviceconfig.primaryKey && typeof serviceconfig.primaryKey == "string" ? serviceconfig.primaryKey : "_id" %>');
		if(!id)
			id = this.get('_id');
		if(!id)
			id = this.get('id');
		
		return id;
		//this.get('<%= serviceconfig.primaryKey && typeof serviceconfig.primaryKey == "string" ? serviceconfig.primaryKey : "_id" %>') ? this['<%= serviceconfig.primaryKey && typeof serviceconfig.primaryKey == "string" ? serviceconfig.primaryKey : "_id" %>'] : this['_id'];
	},
	idAttribute:'<%= serviceconfig.primaryKey && typeof serviceconfig.primaryKey == "string" ? serviceconfig.primaryKey : "_id" %>',
	defaults: {
		<%for( var fieldIndex in serviceconfig.modelfields){var modelfield = serviceconfig.modelfields[fieldIndex];
			if((typeof modelfield.defaultvalue == 'string' )){%>'<%= modelfield.field %>':"<%= modelfield.defaultvalue %>"<%}else{%><%= modelfield.field %>:""<%}%><%if(fieldIndex!=fieldscount-1){%>,<%}%>
		<%}%>
	},
	modelName:'<%= serviceconfig.modelname %>',
	url:function(uri){ 
		if(uri)
			return uri;
		var id = this.id;
		if(!id && this.modelId)
			id = this.modelId();
		if(id)
			return '<%= serviceconfig.apiurl %>/' + id;
		else
			return '<%= serviceconfig.apiurl %>';
	}<%if(typeof serviceconfig.configuration.modelsettings !== 'undefined' ){%>, settings:<%- JSON.stringify(serviceconfig.configuration.modelsettings) %><%}%>
	<%if(typeof serviceconfig.validation !== 'undefined' ){%>, validations:<%- JSON.stringify(serviceconfig.validation) %><%}%>
});

/**
 * Backbone collection <%= serviceconfig.modelname %>
 */
if(!window.<%= serviceconfig.modelname %>Collection || !window.<%= serviceconfig.modelname %>Collection instanceof Backbone.Collection)
	window.<%= serviceconfig.modelname %>Collection = Backbone.Collection.extend({});
	
window.<%= serviceconfig.modelname %>Collection = window.<%= serviceconfig.modelname %>Collection.extend({
    modelId:function(attrs){
		return attrs['_id'] ? attrs['_id'] : attrs['id'];
	},model: window.<%= serviceconfig.modelname %>,
	url:function(uri){
		if(uri)
			return uri;
		else
			return '<%= serviceconfig.apiurl %>';
	}, parse:function(response){
		var self = this;

			if(response && typeof response == 'object' && typeof response.length != 'number' && response["results"]){
				self.totalrecords=response["info"] ? response["info"].count : response["results"].length;
				return response["results"];
			}else
				return response;
	}
});
 