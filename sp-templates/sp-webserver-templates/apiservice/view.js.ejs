<%
var validationcount = 0,
	fieldscount =modelfields.length;
for( var fieldIndex in modelfields) {
  var modelfield = modelfields[fieldIndex];
  if(modelfield.validation) {
	validationcount++;
  }
}
%>
/*
 * Automatically generated by SP Control panel
 * Backbone view configuration specific to the Service - <%= name %>.
 */
/**
 * <%= modelname %> View
 */
window.<%= modelname %>FormView = window.<%= webappsetting && webappsetting.modelname ?  webappsetting.modelname + 'Form' : 'Static' %>View.extend({
	uri:'<%= name %>',title:'<%= modelname %><%= description ? ' / ' + description: '' %>', modelName:'<%= modelname %>FormView', templateName:'serviceform', templatedir:'<%= webappsetting.webappuri %>/service/<%= name %>/templates/',
	afterLoad: function(){
		var self = this;
		
		$("#<%= name %>-form", $(self.el)).validate({
			rules : {<%var validationcount_=0;for( var fieldIndex in modelfields){var modelfield = modelfields[fieldIndex];if(modelfield.validation){%>
				<%= modelfield.field %>:{<%= modelfield.validation %>:true}<%if(validationcount_++<=validationcount){%>,<%}%><%}}%>
			},
			messages : {},
			submitHandler : function(form) {			
				self.model.save(null, {
					success:function(data){						
						app.showFormMessage($(self.el), "<%= modelname %>");
						
						var cururl = location.hash;
				 		setTimeout(function () {
					    	var url = '#<%= name %>/view/' + data.get('_id');
					     	
					     	if(cururl != url&&location.hash==cururl)
					     		app.navigate('#<%= name %>/view/' + data.get('_id'), true); 
					     	}, 2000
					     );
					}, error:function(data, error){						
						app.showFormMessage($(self.el), "<%= modelname %>", error);						
					}
				});				
			}
		});
		
	}
});

/**
 * <%= modelname %> List
 */
window.<%= modelname %>ListView = window.<%= webappsetting && webappsetting.modelname ?  webappsetting.modelname : 'Model' %>ListView.extend({
    uri:'<%= name %>',templateName:'<%= name %>list',modelName:'<%= modelname %>',
    templateName:'servicelist', templatedir:'<%= webappsetting.webappuri %>/service/<%= name %>/templates/',
	title:'<%= modelname %>/Parameter',
	afterload:function(){
		var self = this;
		//@TODO OVERRID for custom changes
	}
});

/**
 * <%= modelname %> details
 */
window.<%= modelname %>View = window.<%= webappsetting && webappsetting.modelname ?  webappsetting.modelname : 'Static' %>View.extend({
	uri:'<%= name %>',modelName:'<%= modelname %>View', templateName:'<%= name %>details',
	templateName:'service', templatedir:'<%= webappsetting.webappuri %>/service/<%= name %>/templates/',
	title:'<%= modelname %>/Parameter',
	afterLoad: function(){
		var self = this;
		//@TODO OVERRID for custom changes
	}
});